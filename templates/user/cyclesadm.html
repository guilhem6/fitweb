<!DOCTYPE html>
<html>
	<head>
	<style>
		#container {
		display: flex;
		justify-content: space-between;
		}

		#left-column {
		width: 70%;
		}

		#right-column {
		width: 30%;
		}

		/*.exercise {
		width: 100px;
		height: 100px;
		background-color: blue;
		margin-bottom: 10px;
		cursor: move;
		}*/

		#timeline {
		width: 100%;
		height: 200px;
		background-color: gray;
		z-index: -3;
		}

				.font-weight-bold{
					font-weight: bold;
				}

				.text-blue{
					color: darkblue;
				}

				.custom-bg-image {
					background-size: cover;
					z-index: 0;
				}

				.image-overlay {
					position: absolute;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					background-color: rgba(255, 255, 255, 0.5); /* Couleur blanche semi-transparente */
					z-index: 1;
				}

				.card-body{
					z-index:2
				}


	</style>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
	<meta name="generator" content="Hugo 0.112.5">

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="../../js/utils.js"></script>

	<script>
		var selectedExercises=[]
		$(document).ready(function() {
		var userid = localStorage.getItem("userid")
		
		$("#validerButton").click(function() {
			var squares = $("#timeline .exercise");
			var order = [];
			squares.each(function() {
			order.push($(this).attr("id"));
			});
			console.log("Exercices sélectionnés : " + order);
			var nom = $('#nom').val();
			var theme = $('#theme').val();
			var dureePause = $('#duree').val();
			var nbRepetitions = $('#nbrepetitions').val();

			var settings = {
				"url": "http://project/api/users/"+userid+"/cycles?title="+nom+"&theme="+theme+"&breaktime="+dureePause+"&repetition="+nbRepetitions,
				"method": "POST",
				"timeout": 0,
				"dataType":"json",
				"headers": {
					"hash": localStorage.getItem("hash")
				},
			};

			$.ajax(settings).done(function (response) {
				console.log(response);
				var id = response.cycle[0].id

			
			

				for(var i=0;i<order.length;i++){
					console.log("ajout du "+i+"e exercice")
					currentOrder = i + 1;
					

					var settings = {
						"url": "http://project/api/users/"+userid+"/cycles/"+id+"?order="+currentOrder+"&duration=60&exerciceid="+order[i],
						"method": "POST",
						"timeout": 0,
						"headers": {
							"hash": localStorage.getItem("hash")
						},
						};

						$.ajax(settings).done(function (response) {
						console.log(response);
						});
					}});
				
			}
		);

		var settings = {
					"url": "http://project/api/exercices",
					"method": "GET",
					"timeout": 0,
					"dataType":"json",
					"headers": {
						"hash": localStorage.getItem("hash")
						},
					};

					$.ajax(settings).done(function (response) {
						var exercices = response.exercices;
						for(var i=0;i<exercices.length;i++){
						exercice = exercices[i]
						console.log(exercice);
						var codeToAdd = `
						<div class="col exercise" id="${exercice.id}">
							<div class="card shadow-sm custom-bg-image" style="background-image: url('http://${exercice.image}');">
								<div class="image-overlay"></div>
								<div class="card-body">
									<p class="card-text font-weight-bold text-blue">${exercice.theme}</p>
									<p class="card-text">${exercice.title}</p>
								</div>
							</div>
						</div>
						`;
						var exerciseElement = $(codeToAdd);
						exerciseElement.addClass("exercise");
						$("#exercisesContainer").append(codeToAdd);
						$(".exercise").draggable({ containment: "body", revert: "invalid" });
						$("#timeline").droppable({
							accept: ".exercise",
							drop: function(event, ui) {
							
							var droppedSquare = ui.draggable;
							console.log("exercise dropped, id : ",droppedSquare.attr("id"))
							droppedSquare.appendTo($(this));
							droppedSquare.css({ top: 0, left: 0 });

							var squares = $(this).children(".exercise");
							var height = (squares.length + 1) * (droppedSquare.outerHeight() + parseInt(squares.css("margin-bottom")));
							$(this).css("height", height);
							}
						});
						}
					});
		});
	</script>
	</head>
	<body onload="load()">
		<div id="header"></div>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
		<div style="padding: 50px" id="container">
			<div id="left-column">
				<h1>Créer un cycle</h1>
				<div class="form-group">
					<label for="nom">Nom du cycle*:</label>
					<input type="text" id="nom" class="form-control" name="nom" required><br/>
				</div>
				<div class="form-group">
					<label for="theme">Th&egrave;me du cycle*</label>
					<select id="theme" name="theme" class="form-select" required>
						<option value="">S&eacute;lectionnez un th&egrave;me</option>
						<option value="Pectoraux">Pectoraux</option>
						<option value="Biceps">Biceps</option>
						<option value="Dos">Dos</option>
						<option value="Jambes">Jambes</option>
						<option value="Cardio">Cardio</option>
					</select><br/>
				</div>
				<label for="theme">Dur&eacute;e de la pause*</label>
				<input type="number" min="0" placeholder="Durée de la pause (en secondes)" id="duree" class="form-control"><br/>
				<label for="theme">Nombre de r&eacute;p&eacute;titions*</label>
				<input type="number" min="0" placeholder="Nombre de répétitions" id="nbrepetitions" class="form-control"><br/>
				<p>Choisir un exercice</p>
				<div class="container">
					<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="exercisesContainer">
					</div>
				</div>
				<div id="right-column">
					<p>Et le placer dans la timeline</p>
					<div id="timeline" class="container"></div>
					<button id="validerButton">VALIDER LE CYCLE</button>
				</div>
			</div>
		</div>

	
	</body>
</html>
